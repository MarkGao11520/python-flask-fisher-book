# 4.2 AppContext、RequestContext、Flask与Request之间的关系

## 1.定位AppContext、RequestContext
Flask有两个上下文，应用上下文-AppContext和请求上下文-RequestContext。他们本质都是对象，是一种封装。应用上下文是对Flask的封装，请求上下文是对Request的封装

下面我们来通过源码，了解一下这两个上下文。
Flask源码的全貌，是在External Libraries/site-pacages/flask下![image.png](https://upload-images.jianshu.io/upload_images/7220971-a5d3da76a5ee10e1.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)
Flask是一个非常好的微框架，里面的源码并不多，大部分都是注释，这给我们可以很方便的阅读源码


我们要看的两个上下文在ctx.py（context的缩写）中，其中的AppContext就是应用上下文，RequestContext就是请求上下文
![image.png](https://upload-images.jianshu.io/upload_images/7220971-75e04ffc4f79a77d.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)


阅读AppContext和RequestContext的构造函数，发现他们都将核心对象app作为了他们的一个属性

```
    def __init__(self, app):
        self.app = app
        self.url_adapter = app.create_url_adapter(None)
        self.g = app.app_ctx_globals_class()

        # Like request context, app contexts can be pushed multiple times
        # but there a basic "refcount" is enough to track them.
        self._refcnt = 0
```
并且他们都有相同的四个方法
```
def push(self):
    ...
def pop(self, exc=_sentinel):
    ...
def __enter__(self):
    ...
def __exit__(self, exc_type, exc_value, tb):
    ...
```

## 2.为什么需要上下文