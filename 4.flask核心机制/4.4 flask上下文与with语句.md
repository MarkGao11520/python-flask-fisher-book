# 4.4 flask上下文与with语句

我们上一小节通过手动将app推入栈，弹出栈的方式，解决了working outside application context的问题。实际上更经典的做法是使用with语句来完成。

首先使用with语句替换之前的代码
```
app = Flask(__name__)

with app.app_context():
    a = current_app
    b = current_app.config["DEBUG"]
```

#### 什么时候可以使用with语句：
> 1.实现了上下文协议的对象，可以使用with语句
  2.对于实现了上下文协议的对象，我们通常称为上下文管理员
  3.通过实现\_\_enter\_\_和\_\_exit__来实现上下文协议
  4.上下文表达式必须返回一个上下文管理器

对于上面一段代码来说，AppContext就是上下文管理器；```app.app_context()```就是上下文表达式


#### 通过数据库的链接和释放来理解with语句的具体含义

连接数据库的操作步骤：
  1.连接数据库
  2.sql或者其他的业务逻辑
  3.释放资源