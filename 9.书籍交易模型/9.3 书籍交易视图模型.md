# 9.3 书籍交易视图模型

书籍详情页，除了需要显示书籍详情信息外。还应该显示其他信息，这些信息分为三类
1.默认情况下，显示想要赠送这本书的人的列表，包括名字和上传时间。
2.如果当前用户是此书的赠送者，应该显示索要这本书的人的列表。
3.如果当前用户是此书的索要者，应该显示想要赠送这本书的人的列表。

综上所述，我们一共需要两个列表，这本书的索要人列表和这本书的赠书人的列表，根据不同情况进行展示。

```python
    # 赠书人列表和索要人列表
    trade_gifts = Gift.query.filter_by(isbn=isbn).all()
    trade_wishs = Wish.query.filter_by(isbn=isbn).all()
```

我们在view_model中处理这两个列表的原始数据，加工成我们姓名，上传时间的列表。由于gifts,wishs两个的加工逻辑一样，只是数据库表不一样，所以可以写一个统一的类trade来处理
```python
class TradeInfo:

    def __init__(self, goods):
        self.total = 0
        self.trades = []
        self.__parse(goods)

    def __parse(self, goods):
        self.total = len(goods)
        self.trades = [self.__map_to_trade(single) for single in goods]

    def __map_to_trade(self, single):
        if single.create_datetime:
            time = single.create_datetime.strftime('%Y-%m-%d')
        else:
            time = '未知'
        return dict(
            user_name=single.user.nickname,
            time=time,
            id=single.id
        )

```
create_time 本是int类型，要进行strftime格式化操作需要转化成string类型，这个操作每个模型都要用到，所以编写在base.py里
```python
    @property
    def create_datetime(self):
        if self.create_time:
            return str(self.create_time)
        else:
            return None
```